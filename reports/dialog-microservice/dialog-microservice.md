# Документация микросервиса диалогов

## Обзор
Микросервис диалогов отвечает за обмен сообщениями между пользователями. Основные функции:
- **Отправка сообщений:** Сохранение нового сообщения от пользователя к пользователю.
- **Получение истории диалога:** Вывод переписки между двумя пользователями.

Перед выполнением операций происходит проверка существования пользователей через вызов монолитного сервиса (с использованием Refit-клиента). Для отслеживания запросов применяется middleware, генерирующий и пробрасывающий x-request-id, а API монолита версионировано для обеспечения обратной совместимости.

## API эндпоинты

### 1. Отправка сообщения
- **Метод:** `POST`
- **URL:** `/api/v1/dialogs/send`
- **Тело запроса (JSON):**
  ```json
  {
    "receiverId": "GUID получателя",
    "text": "Текст сообщения"
  }
  ```
- **Ответы:**
    - `200 OK` – сообщение отправлено.
    - `400 Bad Request` – неверные данные или пользователь не найден.
    - `401 Unauthorized` – пользователь не аутентифицирован.

### 2. Получение истории диалога
- **Метод:** `GET`
- **URL:** `/api/v1/dialogs/list?receiverId={GUID}`
- **Ответ:** Список сообщений, отсортированных по дате создания.


## Интеграция и развертывание
- **Проверка пользователей:** Refit-клиент обращается к монолитному сервису для получения информации по `/users/{id}`.
- **Логирование:** Middleware генерирует и пробрасывает заголовок x-request-id для сквозной трассировки.
- **Версионирование:** API имеет версионирование через URL (например, `/api/v1/...`), что обеспечивает обратную совместимость.
- **Конфигурация:** Настройки (строки подключения, JWT, логирование) задаются в `appsettings.json`.
- **Развертывание:** Микросервис может быть запущен в контейнере Docker или через Docker Compose вместе с монолитом и другими сервисами.