
# Сравнение двух отчётов нагрузочного тестирования

## Отчёт 1 (Cache UDF)

<details>
<summary>Полные метрики</summary>

```
checks.........................: 100.00% ✓ 3745      ✗ 0
data_received..................: 381 MB  2.9 MB/s
data_sent......................: 4.7 MB  36 kB/s
failed_requests................: 3534    26.775618/s
http_req_blocked...............: avg=163.64µs min=952ns    med=3.78µs   max=195.18ms p(90)=311.78µs p(95)=368.68µs
http_req_connecting............: avg=120.85µs min=0s       med=0s       max=133.24ms p(90)=221.14µs p(95)=261.66µs
✗ http_req_duration.............: avg=2.1s     min=1.33ms   med=288.81ms max=6.36s    p(90)=5.9s     p(95)=5.98s
    { expected_response:true }...: avg=473.14ms min=1.33ms   med=55.75ms  max=5.49s    p(90)=1.32s    p(95)=2.83s
http_req_failed................: 31.45%  ✓ 3534      ✗ 7701
http_req_receiving.............: avg=3.41ms   min=17.61µs  med=77.61µs  max=491.17ms p(90)=804.5µs  p(95)=3.21ms
http_req_sending...............: avg=51.98µs  min=7.15µs   med=21.51µs  max=44.91ms  p(90)=76.83µs  p(95)=104.06µs
http_req_tls_handshaking.......: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s
http_req_waiting...............: avg=2.1s     min=1.28ms   med=287.84ms max=6.36s    p(90)=5.9s     p(95)=5.98s
http_reqs......................: 11235   85.122825/s
iteration_duration.............: avg=6.72s    min=421.15ms med=8.26s    max=12.99s   p(90)=12.04s   p(95)=12.2s
iterations.....................: 3745    28.374275/s
response_time..................: avg=3.11s    min=1.33ms   med=4.75s    max=6.36s    p(90)=5.96s    p(95)=5.99s
slow_requests..................: 5059    38.329895/s
successful_requests............: 3956    29.972932/s
vus............................: 21      min=1       max=989
vus_max........................: 1000    min=1000    max=1000
```

</details>

**Ключевые моменты**:
- **RPS (http_reqs / duration)**: ~85 rps
- **Failed requests**: ~31.45% (очень высоко)
- **Среднее время отклика**: ~2.1с (p(95)=5.98с)
- **Максимум**: 6.36с

---

## Отчёт 2 (Postgres Citus)

<details>
<summary>Полные метрики</summary>

```
checks.........................: 100.00% ✓ 9653       ✗ 0
data_received..................: 9.9 GB  79 MB/s
data_sent......................: 12 MB   97 kB/s
failed_requests................: 267     2.136279/s
http_req_blocked...............: avg=143.25µs min=831ns    med=3.68µs   max=95.23ms  p(90)=11.2µs   p(95)=241.75µs
http_req_connecting............: avg=122.17µs min=0s       med=0s       max=95.16ms  p(90)=0s       p(95)=165.51µs
✗ http_req_duration.............: avg=591.52ms min=1.32ms   med=48.51ms  max=6.33s    p(90)=2.24s    p(95)=2.93s
    { expected_response:true }...: avg=582.33ms min=1.32ms   med=46.73ms  max=6.33s    p(90)=2.23s    p(95)=2.93s
http_req_failed................: 0.92%   ✓ 267        ✗ 28692
http_req_receiving.............: avg=86.68ms  min=15.28µs  med=87.62µs  max=4.62s    p(90)=334.89ms p(95)=486.56ms
http_req_sending...............: avg=91.45µs  min=6.37µs   med=19.69µs  max=160.78ms p(90)=51.05µs  p(95)=73.1µs
http_req_tls_handshaking.......: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s
http_req_waiting...............: avg=504.75ms min=1.25ms   med=46.25ms  max=4.41s    p(90)=1.92s    p(95)=2.58s
http_reqs......................: 28959   231.702281/s
iteration_duration.............: avg=2.17s    min=417.34ms med=915.8ms  max=9.92s    p(90)=5.89s    p(95)=6.43s
iterations.....................: 9653    77.234094/s
response_time..................: avg=848.5ms  min=1.32ms   med=149.94ms max=6.33s    p(90)=2.69s    p(95)=3.22s
slow_requests..................: 8295    66.368674/s
successful_requests............: 19039   152.331908/s
vus............................: 143     min=1        max=994
vus_max........................: 1000    min=1000     max=1000
```

</details>

**Ключевые моменты**:
- **RPS**: ~232 rps
- **Failed requests**: ~0.92%
- **Среднее время отклика**: ~591ms (p(95)=2.93с)
- **Максимум**: 6.33s

---

## Сравнительная сводка

| Параметр                   | Отчёт 1 (Cache UDF)                        | Отчёт 2 (Postgres Citus)             |
|----------------------------|--------------------------------------------|--------------------------------------|
| **RPS**                    | ~85 rps                                    | ~232 rps                             |
| **data_received**          | 381 MB (2.9 MB/s)                          | 9.9 GB (79 MB/s)                     |
| **data_sent**             | 4.7 MB (36 kB/s)                           | 12 MB (97 kB/s)                      |
| **Failed Requests**        | ~31.45%                                    | ~0.92%                                |
| **Средняя задержка**       | ~2.1s                                      | ~591ms                                |
| **p(95) задержка**         | ~5.98s                                     | ~2.93s                                |
| **Максимальная задержка**  | ~6.36s                                     | ~6.33s                                |
| **Уровень успеха (checks)**| 100% checks OK, но 31% fail запросов       | 100% checks, <1% fail запросов       |

### Выводы

1. **Пропускная способность** (RPS):
    - Отчёт 2 (Postgres Citus) обрабатывает в ~2.5–3 раза больше запросов в секунду (≈232 rps против ~85).
2. **Процент ошибок**:
    - В отчёте 1 (Cache UDF) огромный процент неуспешных запросов (31.45%).
    - В отчёте 2 — всего ~0.92% fails.
3. **Время ответа**:
    - Отчёт 1 имеет среднее ~2.1с, p(95)=5.98s. Указывает, что примерно 5% запросов уходят к 6s.
    - Отчёт 2 имеет среднее ~0.59s, p(95)=2.93s.
4. **Объём данных**:
    - Отчёт 1: ~381MB `data_received`.
    - Отчёт 2: ~9.9GB (значительно выше), при том что сервис выдерживает большую нагрузку.

Таким образом, **по данным**:
- Отчёт 2 показывает **большую производительность** (выше RPS, меньше ошибок).
- Отчёт 1 испытывает существенный процент неудач и более высокую среднюю задержку.